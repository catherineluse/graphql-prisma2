# Migration `20200628151933`

This migration has been generated by catherineluse at 6/28/2020, 3:19:33 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."SubscribersOfCommunities" (
"communityId" integer  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"userId" integer  NOT NULL ,
    PRIMARY KEY ("communityId","userId"))

CREATE TABLE "public"."CreatorsOfCommunities" (
"communityId" integer  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"userId" integer  NOT NULL ,
    PRIMARY KEY ("communityId","userId"))

CREATE TABLE "public"."AuthorsOfMessages" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"messageId" integer  NOT NULL ,"userId" integer  NOT NULL ,
    PRIMARY KEY ("messageId","userId"))

CREATE TABLE "public"."RecipientsOfMessages" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"messageId" integer  NOT NULL ,"userId" integer  NOT NULL ,
    PRIMARY KEY ("messageId","userId"))

CREATE TABLE "public"."_SubscribersOfCommunities" (
"A" integer  NOT NULL ,"B" integer  NOT NULL )

ALTER TABLE "public"."User" ALTER COLUMN "handle" SET NOT NULL;

CREATE UNIQUE INDEX "_SubscribersOfCommunities_AB_unique" ON "public"."_SubscribersOfCommunities"("A","B")

CREATE  INDEX "_SubscribersOfCommunities_B_index" ON "public"."_SubscribersOfCommunities"("B")

ALTER TABLE "public"."SubscribersOfCommunities" ADD FOREIGN KEY ("communityId")REFERENCES "public"."Community"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."SubscribersOfCommunities" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."CreatorsOfCommunities" ADD FOREIGN KEY ("communityId")REFERENCES "public"."Community"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."CreatorsOfCommunities" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."AuthorsOfMessages" ADD FOREIGN KEY ("messageId")REFERENCES "public"."Message"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."AuthorsOfMessages" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."RecipientsOfMessages" ADD FOREIGN KEY ("messageId")REFERENCES "public"."Message"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."RecipientsOfMessages" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_SubscribersOfCommunities" ADD FOREIGN KEY ("A")REFERENCES "public"."Community"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_SubscribersOfCommunities" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Message" ADD FOREIGN KEY ("recipientId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER INDEX "public"."User_email_key" RENAME TO "User.email"

ALTER INDEX "public"."User_handle_key" RENAME TO "User.handle"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200616232934..20200628151933
--- datamodel.dml
+++ datamodel.dml
@@ -1,76 +1,118 @@
-// This is your Prisma schema file,
-// learn more about it in the docs: https://pris.ly/d/prisma-schema
+generator client {
+  provider = "prisma-client-js"
+}
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
-generator client {
-  provider = "prisma-client-js"
+model Comment {
+  authorId      Int
+  createdAt     DateTime   @default(now())
+  discussionId  Int
+  id            Int        @id
+  text          String
+  User          User       @relation(fields: [authorId], references: [id])
+  Discussion    Discussion @relation(fields: [discussionId], references: [id])
+  parentComment Comment    @relation("CommentToComment_id", fields: [id], references: [id])
+  childComment  Comment[]  @relation("CommentToComment_id")
 }
-model User {
-  id               Int          @id @default(autoincrement())
-  name             String
-  email            String       @unique
-  age              Int?
-  createdAt        DateTime     @default(now())
-  updatedAt        DateTime     @updatedAt
-  discussions      Discussion[]
-  comments         Comment[]
-  sentMessages     Message[]    @relation("MessageAuthor")
-  receivedMessages Message[]    @relation("MessageRecipient")
-  community        Community[]
-  role             Role         @default(USER)
+model Community {
+  createdAt                DateTime                   @default(now())
+  creatorId                Int
+  description              String?
+  id                       Int                        @default(autoincrement()) @id
+  name                     String
+  url                      String                     @unique
+  Creator                  User                       @relation("CreatorsOfCommunities", fields: [creatorId], references: [id])
+  Subscribers              User[]                     @relation("SubscribersOfCommunities", references: [id])
+  Discussion               Discussion[]
+  SubscribersOfCommunities SubscribersOfCommunities[]
+  CreatorsOfCommunities    CreatorsOfCommunities[]
 }
 model Discussion {
-  id           Int       @id @default(autoincrement())
-  community    Community @relation(fields: [communityId], references: [id])
-  communityId  Int
-  title        String
-  body         String?
-  author       User      @relation(fields: [authorId], references: [id])
-  authorId     Int
-  rootComments Comment[]
-  createdAt    DateTime  @default(now())
+  authorId    Int
+  body        String?
+  communityId Int
+  createdAt   DateTime  @default(now())
+  id          Int       @default(autoincrement()) @id
+  title       String
+  User        User      @relation(fields: [authorId], references: [id])
+  Community   Community @relation(fields: [communityId], references: [id])
+  Comment     Comment[]
 }
-model Comment {
-  id            Int        @id @default(autoincrement())
-  text          String
-  author        User       @relation(fields: [authorId], references: [id])
-  authorId      Int
-  discussion    Discussion @relation(fields: [discussionId], references: [id])
-  discussionId  Int
-  parentComment Comment    @relation("ParentChildComments", fields: [id], references: [id])
-  childComments Comment[]  @relation("ParentChildComments")
-  createdAt     DateTime   @default(now())
+model Message {
+  authorId             Int
+  createdAt            DateTime               @default(now())
+  id                   Int                    @default(autoincrement()) @id
+  recipientId          Int
+  text                 String
+  Author               User                   @relation("AuthorsOfMessages", fields: [authorId], references: [id])
+  Recipient            User                   @relation("RecipientsOfMessages", fields: [recipientId], references: [id])
+  AuthorsOfMessages    AuthorsOfMessages[]
+  RecipientsOfMessages RecipientsOfMessages[]
 }
-model Message {
-  id          Int      @id @default(autoincrement())
-  text        String
-  author      User     @relation(name: "MessageAuthor", fields: [authorId], references: [id])
-  authorId    Int
-  recipient   User     @relation(name: "MessageRecipient", fields: [authorId], references: [id])
-  recipientId Int
-  createdAt   DateTime @default(now())
-} 
-
-model Community {
-  id          Int          @id @default(autoincrement())
-  creator     User         @relation(fields: [creatorId], references: [id])
-  creatorId   Int
-  url         String       @unique
-  name        String
-  description String?
-  discussions Discussion[]
-  createdAt   DateTime     @default(now())
+model User {
+  age                      Int?
+  createdAt                DateTime                   @default(now())
+  email                    String                     @unique
+  id                       Int                        @default(autoincrement()) @id
+  name                     String
+  handle                   String                     @unique
+  Comment                  Comment[]
+  CreatorOfCommunities     Community[]                @relation("CreatorsOfCommunities")
+  SubscriberOfCommunities  Community[]                @relation("SubscribersOfCommunities", references: [id])
+  Discussion               Discussion[]
+  SentMessages             Message[]                  @relation("AuthorsOfMessages")
+  ReceivedMessages         Message[]                  @relation("RecipientsOfMessages")
+  SubscribersOfCommunities SubscribersOfCommunities[]
+  CreatorsOfCommunities    CreatorsOfCommunities[]
+  AuthorsOfMessages        AuthorsOfMessages[]
+  RecipientsOfMessages     RecipientsOfMessages[]
 }
 enum Role {
   ADMIN
   USER
 }
+
+model SubscribersOfCommunities {
+  Community   Community @relation(fields: [communityId], references: [id])
+  communityId Int
+  User        User      @relation(fields: [userId], references: [id])
+  userId      Int
+  createdAt   DateTime  @default(now())
+  @@id([communityId, userId])
+}
+
+model CreatorsOfCommunities {
+  Community   Community @relation(fields: [communityId], references: [id])
+  communityId Int
+  User        User      @relation(fields: [userId], references: [id])
+  userId      Int
+  createdAt   DateTime  @default(now())
+  @@id([communityId, userId])
+}
+
+model AuthorsOfMessages {
+  Message   Message  @relation(fields: [messageId], references: [id])
+  messageId Int
+  User      User     @relation(fields: [userId], references: [id])
+  userId    Int
+  createdAt DateTime @default(now())
+  @@id([messageId, userId])
+}
+
+model RecipientsOfMessages {
+  Message   Message  @relation(fields: [messageId], references: [id])
+  messageId Int
+  User      User     @relation(fields: [userId], references: [id])
+  userId    Int
+  createdAt DateTime @default(now())
+  @@id([messageId, userId])
+}
```


